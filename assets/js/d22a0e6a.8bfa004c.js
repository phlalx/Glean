"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[586],{3905:function(e,a,t){t.r(a),t.d(a,{MDXContext:function(){return d},MDXProvider:function(){return p},mdx:function(){return f},useMDXComponents:function(){return c},withMDXComponents:function(){return m}});var n=t(67294);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function o(){return o=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},o.apply(this,arguments)}function i(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function s(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?i(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function l(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var d=n.createContext({}),m=function(e){return function(a){var t=c(a.components);return n.createElement(e,o({},a,{components:t}))}},c=function(e){var a=n.useContext(d),t=a;return e&&(t="function"==typeof e?e(a):s(s({},a),e)),t},p=function(e){var a=c(e.components);return n.createElement(d.Provider,{value:a},e.children)},u={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},h=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),m=c(t),p=r,h=m["".concat(i,".").concat(p)]||m[p]||u[p]||o;return t?n.createElement(h,s(s({ref:a},d),{},{components:t})):n.createElement(h,s({ref:a},d))}));function f(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=h;var s={};for(var l in a)hasOwnProperty.call(a,l)&&(s[l]=a[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var d=2;d<o;d++)i[d]=t[d];return n.createElement.apply(null,i)}return n.createElement.apply(null,t)}h.displayName="MDXCreateElement"},68863:function(e,a,t){t.r(a),t.d(a,{contentTitle:function(){return m},default:function(){return f},frontMatter:function(){return d},metadata:function(){return c},toc:function(){return p}});var n,r=t(87462),o=t(63366),i=(t(67294),t(3905)),s=t(44256),l=["components"],d={id:"databases",title:"Glean Databases",sidebar_label:"Glean Databases"},m=void 0,c={unversionedId:"databases",id:"databases",isDocsHomePage:!1,title:"Glean Databases",description:"Glean stores facts in databases.",source:"@site/docs/databases.md",sourceDirName:".",slug:"/databases",permalink:"/docs/databases",editUrl:"https://github.com/facebookincubator/Glean/tree/main/glean/website/docs/databases.md",tags:[],version:"current",frontMatter:{id:"databases",title:"Glean Databases",sidebar_label:"Glean Databases"},sidebar:"someSidebar",previous:{title:"Derived Predicates",permalink:"/docs/derived"},next:{title:"Writing data to Glean",permalink:"/docs/write"}},p=[{value:"Working with local databases",id:"working-with-local-databases",children:[],level:2},{value:"Lifecycle of a database",id:"lifecycle-of-a-database",children:[],level:2}],u=(n="Lifecycle",function(e){return console.warn("Component "+n+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.mdx)("div",e)}),h={toc:p};function f(e){var a=e.components,t=(0,o.Z)(e,l);return(0,i.mdx)("wrapper",(0,r.Z)({},h,t,{components:a,mdxType:"MDXLayout"}),(0,i.mdx)("p",null,"Glean stores facts in databases."),(0,i.mdx)("p",null,"A Glean database has:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"A ",(0,i.mdx)("strong",{parentName:"li"},"name"),'. This is often (but not always) the name of the source code repository from which the facts in the database were collected. Indeed, for historical reasons we sometimes say "repository" or "repo" when we mean "database".'),(0,i.mdx)("li",{parentName:"ul"},"A ",(0,i.mdx)("strong",{parentName:"li"},"hash"),". This is just an arbitrary string, used to distinguish different versions of databases with the same name. For source code repositories it can be the revision of the repository that was indexed."),(0,i.mdx)("li",{parentName:"ul"},"Some ",(0,i.mdx)("strong",{parentName:"li"},"properties"),". A database has a set of key-value pairs associated with it. Some of these are created by Glean itself, and others can be set by a client when the DB is created, or while writing facts. Properties can be used to store arbitrary metadata about the DB, and can be accessed cheaply.")),(0,i.mdx)(s.FbInternalOnly,{mdxType:"FbInternalOnly"},(0,i.mdx)("p",null,"At Facebook, we have adopted an informal convention for database names: ",(0,i.mdx)("inlineCode",{parentName:"p"},"<repo>.<use-case>"),". For example, test coverage data for the ",(0,i.mdx)("inlineCode",{parentName:"p"},"www")," repo uses the database name ",(0,i.mdx)("inlineCode",{parentName:"p"},"www.tcc"),". We sometimes omit the use case if the database is for primary source code indexing of the repo, so for example the index of Hack code in ",(0,i.mdx)("inlineCode",{parentName:"p"},"www"),' is called just "',(0,i.mdx)("inlineCode",{parentName:"p"},"www"),'".')),(0,i.mdx)("p",null,"The name and hash together uniquely identify a database. This is written ",(0,i.mdx)("inlineCode",{parentName:"p"},"<name>/<hash>"),", and it is how you refer to a database in most cases when working with Glean. For example, in the shell's ",(0,i.mdx)("inlineCode",{parentName:"p"},":db")," command, or the ",(0,i.mdx)("inlineCode",{parentName:"p"},"--repo")," argument to the command-line tools."),(0,i.mdx)("h2",{id:"working-with-local-databases"},"Working with local databases"),(0,i.mdx)("p",null,"Most Glean tools (in particular the ",(0,i.mdx)("a",{parentName:"p",href:"/docs/shell"},"shell")," and the ",(0,i.mdx)("a",{parentName:"p",href:"/docs/cli"},"CLI\ntool"),") can work either by talking to a ",(0,i.mdx)("a",{parentName:"p",href:"/docs/server"},"Glean server")," or\naccessing databases on the local filesystem directly. The access\nmethod is chosen by these command-line flags:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"--service <tier>")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"--service <host>:<port>"),"  Connect to a remote Glean server."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"--db-root <dir>"),"  Use databases stored locally in the directory ",(0,i.mdx)("inlineCode",{parentName:"li"},"<dir>")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"--db-tmp")," Create a temporary directory to store DBs and delete it\nwhen the program exits.")),(0,i.mdx)("p",null,"These flags are accepted by all the Glean command-line tools,\nincluding ",(0,i.mdx)("inlineCode",{parentName:"p"},"glean")," and ",(0,i.mdx)("inlineCode",{parentName:"p"},"glean-server"),"."),(0,i.mdx)(s.FbInternalOnly,{mdxType:"FbInternalOnly"},(0,i.mdx)("p",null,"The default for all commands is ",(0,i.mdx)("inlineCode",{parentName:"p"},"--service glean.query.prod"),", so all requests go to the production Glean query service.")),(0,i.mdx)("p",null,"To use the ",(0,i.mdx)("a",{parentName:"p",href:"/docs/shell"},"shell")," with local databases, you can do:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-lang=sh"},"mkdir /tmp/glean\nglean shell --db-root /tmp/glean\n")),(0,i.mdx)("p",null,"To run a server, see ",(0,i.mdx)("a",{parentName:"p",href:"/docs/server"},"Running the Glean Server"),"."),(0,i.mdx)("h2",{id:"lifecycle-of-a-database"},"Lifecycle of a database"),(0,i.mdx)("p",null,"A database will typically be created by an automatic periodic job to\nindex the current state of a source repository.  The process works\nlike this:"),(0,i.mdx)(u,{mdxType:"Lifecycle"}),(0,i.mdx)(s.OssOnly,{mdxType:"OssOnly"},(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"The job invokes ",(0,i.mdx)("inlineCode",{parentName:"p"},"glean kickoff --service <write-server> <args>")," to create the database.")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"At this point the database is in the ",(0,i.mdx)("strong",{parentName:"p"},"Incomplete")," state. Queries\nare supported in this state, and always reflect the current contents.")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"Facts are written to the database using the methods described in ",(0,i.mdx)("a",{parentName:"p",href:"/docs/write"},"Writing data to Glean"),", and finally the database is closed by invoking ",(0,i.mdx)("inlineCode",{parentName:"p"},"glean finish --service <write-server> <args>")," or the appropriate Thrift method.")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"The database is now in the ",(0,i.mdx)("strong",{parentName:"p"},"Complete")," state.")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"If backups are allowed for this database, then:"),(0,i.mdx)("ul",{parentName:"li"},(0,i.mdx)("li",{parentName:"ul"},"the write server uploads the database to backup storage."),(0,i.mdx)("li",{parentName:"ul"},"servers that are configured to restore databases automatically can download the DB from backup storage, and use it to serve queries from clients.")))),(0,i.mdx)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.mdx)("div",{parentName:"div",className:"admonition-heading"},(0,i.mdx)("h5",{parentName:"div"},(0,i.mdx)("span",{parentName:"h5",className:"admonition-icon"},(0,i.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.mdx)("div",{parentName:"div",className:"admonition-content"},(0,i.mdx)("p",{parentName:"div"},"There are currently no backup backends implemented for open-source Glean.")))))}f.isMDXComponent=!0}}]);