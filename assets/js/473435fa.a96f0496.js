"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[731],{3905:function(e,n,t){t.r(n),t.d(n,{MDXContext:function(){return s},MDXProvider:function(){return g},mdx:function(){return h},useMDXComponents:function(){return d},withMDXComponents:function(){return c}});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(){return o=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},o.apply(this,arguments)}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function u(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=r.createContext({}),c=function(e){return function(n){var t=d(n.components);return r.createElement(e,o({},n,{components:t}))}},d=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},g=function(e){var n=d(e.components);return r.createElement(s.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,s=u(e,["components","mdxType","originalType","parentName"]),c=d(t),g=a,m=c["".concat(i,".").concat(g)]||c[g]||p[g]||o;return t?r.createElement(m,l(l({ref:n},s),{},{components:t})):r.createElement(m,l({ref:n},s))}));function h(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=m;var l={};for(var u in n)hasOwnProperty.call(n,u)&&(l[u]=n[u]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var s=2;s<o;s++)i[s]=t[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},2896:function(e,n,t){t.r(n),t.d(n,{contentTitle:function(){return u},default:function(){return g},frontMatter:function(){return l},metadata:function(){return s},toc:function(){return c}});var r=t(87462),a=t(63366),o=(t(67294),t(3905)),i=(t(44256),["components"]),l={id:"debugging",title:"Debugging",sidebar_label:"Debugging"},u=void 0,s={unversionedId:"angle/debugging",id:"angle/debugging",isDocsHomePage:!1,title:"Debugging",description:"Typically you want to do most of your debugging in the",source:"@site/docs/angle/debugging.md",sourceDirName:"angle",slug:"/angle/debugging",permalink:"/docs/angle/debugging",editUrl:"https://github.com/facebookincubator/Glean/tree/main/glean/website/docs/angle/debugging.md",tags:[],version:"current",frontMatter:{id:"debugging",title:"Debugging",sidebar_label:"Debugging"},sidebar:"someSidebar",previous:{title:"Advanced Query Features",permalink:"/docs/angle/advanced"},next:{title:"Reference",permalink:"/docs/angle/reference"}},c=[{value:"Debugging a slow query",id:"debugging-a-slow-query",children:[],level:2},{value:"Showing the internals",id:"showing-the-internals",children:[],level:2}],d={toc:c};function g(e){var n=e.components,t=(0,a.Z)(e,i);return(0,o.mdx)("wrapper",(0,r.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,o.mdx)("p",null,"Typically you want to do most of your debugging in the\n",(0,o.mdx)("a",{parentName:"p",href:"/docs/shell"},"shell"),", where you can experiment with queries quickly and\neasily."),(0,o.mdx)("p",null,"If you're writing particularly complex queries, then consider using ",(0,o.mdx)("a",{parentName:"p",href:"/docs/derived"},"Derived Predicates")," to structure your query and to allow parts of the query to be re-used. To iterate on derived predicates, see ",(0,o.mdx)("a",{parentName:"p",href:"/docs/derived#how-do-i-write-and-test"},"How do I write and test a derived predicate?")),(0,o.mdx)("h2",{id:"debugging-a-slow-query"},"Debugging a slow query"),(0,o.mdx)("p",null,"Performance debugging can be tricky, because Angle is a very declarative language. There are often many ways to write the query that are correct, but not all of them will be fast."),(0,o.mdx)("p",null,"The shell provides a few facilities to help with this."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},"> :profile full\n")),(0,o.mdx)("p",null,"Turning on query profiling allows you to see how many facts of each predicate are being searched by your query. For example:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},'fbsource> search.cxx.SearchByNameAndScope { name = "Future" }\n...\nFacts searched:\n                cxx1.RecordDeclaration.1 : 103\n             cxx1.TypeAliasDeclaration.2 : 11\n                            cxx1.QName.1 : 8\n              cxx1.VariableDeclaration.2 : 7\n                  cxx1.EnumDeclaration.1 : 7\n                             cxx1.Name.1 : 1\n')),(0,o.mdx)("p",null,"If your query is expensive, then likely you will see some large numbers next to one or more predicates. This is a sign that you probably want to reorder the statements in your query, or lift out some nested queries into statements so that you can control the ordering more precisely."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre"},"> :debug on\n")),(0,o.mdx)("h2",{id:"showing-the-internals"},"Showing the internals"),(0,o.mdx)("p",null,"The shell provides ways to show what Glean's query engine is doing internally. This is mostly useful for those working on the query engine itself, but it might also be helpful when debugging queries."),(0,o.mdx)("div",{className:"admonition admonition-warning alert alert--danger"},(0,o.mdx)("div",{parentName:"div",className:"admonition-heading"},(0,o.mdx)("h5",{parentName:"div"},(0,o.mdx)("span",{parentName:"h5",className:"admonition-icon"},(0,o.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,o.mdx)("div",{parentName:"div",className:"admonition-content"},(0,o.mdx)("p",{parentName:"div"},"We provide no guarantees about this functionality and it might change\nwithout warning."))),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-lang=sh"},"> :debug ir\n")),(0,o.mdx)("p",null,"Shows the internal representation of the query after parsing, name resolution, type checking, and various transformations to simplify it.  In particular, all the nesting has been flattened at this stage, so you can see the exact order of the searches on each predicate, which might help with performance debugging."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-lang=sh"},"> :debug bytecode\n")),(0,o.mdx)("p",null,"Shows the compiled bytecode for the query. This is what Glean's virtual machine (VM) will execute to perform the query. Probably not all that useful for debugging queries."))}g.isMDXComponent=!0}}]);